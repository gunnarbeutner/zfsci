#!/usr/bin/env python
import sys
import os
import glob
import json
from tasklib import Attribute

if len(sys.argv) < 2:
	print 'Syntax: %s <jobs-dir>' % (sys.argv[0])
	sys.exit(1)

jobsdir = sys.argv[1]

if not os.path.isdir(jobsdir):
	print 'Jobs dir "%s" does not exist.' % (jobsdir)
	sys.exit(1)

for taskfile in glob.glob('%s/*.py' % (jobsdir)):
	execfile(taskfile)

try:
	os.makedirs('build/jobs')
except OSError:
	pass

jobdescs = Attribute.get_jobdescs()
for jobdesc in jobdescs:
	fp = open('build/jobs/%s.json' % (jobdesc['job_id']), 'w')
	json.dump(jobdesc, fp)
	fp.close()

print 'Successfully built %d job descriptions.' % (len(jobdescs))

sys.exit(0)
